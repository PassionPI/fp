"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const{freeze:w,create:j}=Object;class d extends Array{}const g=e=>e instanceof d,i=e=>g(e)?e[0]?e:i():w(d.of(e instanceof Error?e:Error(typeof e=="object"?JSON.stringify(e):String(e)),null)),u=e=>g(e)?e:w(d.of(null,e)),f=[u,i],a=e=>new Proxy(e,{async apply(...t){try{return u(await Reflect.apply(...t))}catch(n){return i(n)}}}),R=()=>{let e,t;const n=new Promise((r,o)=>{[e,t]=[r,o]});return{resolve:e,reject:t,pending:a(()=>n)()}},P=Symbol(),T=(e,t)=>{const n=[];let r=-1,o=-1;for(;++r<e.length;)n.push(e[r]===P?t[++o]:e[r]);for(;++o<t.length;)n.push(t[o]);return n},E=e=>t=>{const n=r=>new Proxy(t,{apply(o,s,p){const l=T(r,p).slice(0,e);return l.length===e&&!l.includes(P)?Reflect.apply(o,s,l):n(l)}});return n([])},O=E(2),y=e=>new Promise(t=>setTimeout(t,e)),z=O((e,t)=>{let n=!0;const r=()=>{n=!1};return{loop:a(async()=>{for(n=!0,await y(e);n;)await t(),await y(e)}),stop:r}}),m=(...e)=>t=>{for(const n of e)t=n(t);return t},F=(...e)=>async t=>{for(const n of e)t=n(await t);return t},L=e=>{let t=null;return new Proxy(e,{async apply(...n){t==null&&(t=Promise.resolve(Reflect.apply(...n)));const r=await t;return t=null,r}})},M=m(L,a),N=e=>{let t=!1,n;return(...r)=>(t||(t=!0,n=e(...r)),n)},U=(e,t)=>{const n=(e==null?void 0:e.length)??0;return r=>{const o=async s=>s<n?await e[s](r,N(()=>o(s+1))):await t(r);return o(0)}};class _ extends Promise{pipe(t){return super.then(n=>n[0]?n:t(n[1])).then(...f)}ap(t){return super.then(n=>n[0]?n:n[1](t)).then(...f)}}const x=e=>_.resolve(e).then(...f),S=Symbol(),b=Symbol(),h=e=>e&&e[S]==b,c=e=>{if(h(e))return e;if(!g(e))return c(u(e));const[t,n]=e;if(h(n))return n;const r=(s,p)=>{try{return c(u(s(p)))}catch(l){return c(i(l))}},o=j(null);return o[S]=b,o.join=()=>e,o.map=s=>t?o:r(s,n),o.ap=s=>t?o:r(n,s),w(o)},A=e=>{const t=new Map;return{get(n){const r=t.get(n);return t.has(n)&&(t.delete(n),t.set(n,r)),r},set(n,r){t.has(n)&&t.delete(n),t.set(n,r),t.size>e&&t.delete(t.keys().next().value)}}};exports.LRU=A;exports.asyncPipe=F;exports.defer=R;exports.either=a;exports.functor=c;exports.interval=z;exports.isFunctor=h;exports.lock=M;exports.oni=U;exports.pipe=m;exports.pipeline=x;exports.wait=y;
